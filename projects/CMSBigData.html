---
layout: default
title: CMS Big Data
---

<h1>CMS Big Data</h1>
<h4>Setting up jupyter notebook</h4>
<ul>
  <li><p>A ssh tunnel is necesary in order to run jupyter locally in the browser. First ssh into your cluster with command below:</p>
  <pre><code>
  ssh -L localhost:1122:localhost:1122 shoh@10.64.22.66
  </code></pre>
  <li><p>After logging into the cluster, launch the jupyter notebook with</p>
  <pre><code>
  jupyter notebook --no-browser --port=1122 --ip=127.0.0.1
  </code></pre>
  <p>It will yield a link which needed to be pasted in the url field in the browser, if everything is ok, the browser will load the cluster 
    environment with jupyter notebook. You are good to go.</p>
</ul>
<h4>Verify Spark is Properly Installed</h4>
<ul>
  <li><p>Each notebook runs as a separate Python process, but Spark itself is implemented in Scala (which is related to Java). 
    The PySpark interface connects the two languages and handles passing data back and forth between the two. To gain access to Spark, 
    you first need to create a SparkSession who loads the Scala binaries via PySpark. Once the connection is complete, 
    PySpark returns a SparkSession, which is the central entrypoint to Spark.</p>
    
    <pre><code>
    from pyspark.sql import SparkSession
    spark = SparkSession.builder \
    .master(
        "spark://10.64.22.66:7077"
    ) \
    .appName(# Name of your application in the dashboard/UI
             "printNanoAodAPP"
            ) \
    .config(# Tell Spark to load some extra libraries from Maven (the Java repository)
            'spark.jars.packages',
            'org.diana-hep:spark-root_2.11:0.1.13,org.diana-hep:histogrammar-sparksql_2.11:1.0.4',
            ) \
    .config('spark.cores.max',3
            ) \
    .getOrCreate()

#Read the ROOT file into a Spark DataFrame
df = spark.read.format("org.dianahep.sparkroot").load("hdfs:/user/shoh/output.root")
# ... and print the number of events
print df.count()

#show GenMET_pt and HLTT_AK8PFHT750_TrimMass50
df.select("GenMET_pt","HLT_AK8PFHT750_TrimMass50").show(3)
    </code></pre>
    <p>The operation on files stored in hdfs could be found <a href="https://indico.cern.ch/event/404527/contributions/968835/attachments/1123385/1603232/Introduction_to_HDFS.pdf" target="_blank">here</a></p>
</ul>
